<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LoRa-BLE-Sensor: app/src/sensor_nvs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LoRa-BLE-Sensor<span id="projectnumber">&#160;0.4.1-5-gfba7e49</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d422163b96683743ed3963d4aac17747.html">app</a></li><li class="navelem"><a class="el" href="dir_a8f641299cfea9f7461c2df1141b7786.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">sensor_nvs.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This is a library to keep track of sensor information and configurations that are stored in the non-volatile storage (NVS) of the device. nrf52840_partition gives 32KB for storage_partition.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sensor__nvs_8h_source.html">sensor_nvs.h</a>&quot;</code><br />
<code>#include &lt;zephyr/fs/nvs.h&gt;</code><br />
<code>#include &lt;zephyr/logging/log.h&gt;</code><br />
<code>#include &lt;zephyr/storage/flash_map.h&gt;</code><br />
<code>#include &lt;zephyr/drivers/flash.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for sensor_nvs.c:</div>
<div class="dyncontent">
<div class="center"><img src="sensor__nvs_8c__incl.png" border="0" usemap="#aapp_2src_2sensor__nvs_8c" alt=""/></div>
<map name="aapp_2src_2sensor__nvs_8c" id="aapp_2src_2sensor__nvs_8c">
<area shape="rect" title="This is a library to keep track of sensor information and configurations that are stored in the non&#45;v..." alt="" coords="311,5,469,31"/>
<area shape="rect" href="sensor__nvs_8h.html" title="This is a library to keep track of sensor information and configurations that are stored in the non&#45;v..." alt="" coords="35,86,142,111"/>
<area shape="poly" title=" " alt="" coords="344,33,156,81,142,85,141,80,155,76,343,28"/>
<area shape="rect" title=" " alt="" coords="167,86,288,111"/>
<area shape="poly" title=" " alt="" coords="367,33,264,83,262,78,365,28"/>
<area shape="rect" title=" " alt="" coords="313,86,467,111"/>
<area shape="poly" title=" " alt="" coords="393,31,393,72,387,72,387,31"/>
<area shape="rect" title=" " alt="" coords="491,79,646,119"/>
<area shape="poly" title=" " alt="" coords="417,28,514,71,512,76,415,33"/>
<area shape="rect" title=" " alt="" coords="670,86,833,111"/>
<area shape="poly" title=" " alt="" coords="443,28,686,80,685,86,442,33"/>
<area shape="rect" title=" " alt="" coords="5,167,76,192"/>
<area shape="poly" title=" " alt="" coords="84,113,57,156,53,154,79,110"/>
<area shape="rect" title=" " alt="" coords="101,167,175,192"/>
<area shape="poly" title=" " alt="" coords="98,110,126,154,121,156,94,113"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af729ab27c6be48ab7a2fa0d9779ed594" id="r_af729ab27c6be48ab7a2fa0d9779ed594"><td class="memItemLeft" align="right" valign="top"><a id="af729ab27c6be48ab7a2fa0d9779ed594" name="af729ab27c6be48ab7a2fa0d9779ed594"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NVS_PARTITION</b>&#160;&#160;&#160;storage_partition</td></tr>
<tr class="separator:af729ab27c6be48ab7a2fa0d9779ed594"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3dce2e576a700556320e93eb373ed73" id="r_ab3dce2e576a700556320e93eb373ed73"><td class="memItemLeft" align="right" valign="top"><a id="ab3dce2e576a700556320e93eb373ed73" name="ab3dce2e576a700556320e93eb373ed73"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NVS_PARTITION_DEVICE</b>&#160;&#160;&#160;FIXED_PARTITION_DEVICE(NVS_PARTITION)</td></tr>
<tr class="separator:ab3dce2e576a700556320e93eb373ed73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d2e807fcd3e49aaf4c40d17a203dc01" id="r_a9d2e807fcd3e49aaf4c40d17a203dc01"><td class="memItemLeft" align="right" valign="top"><a id="a9d2e807fcd3e49aaf4c40d17a203dc01" name="a9d2e807fcd3e49aaf4c40d17a203dc01"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NVS_PARTITION_OFFSET</b>&#160;&#160;&#160;FIXED_PARTITION_OFFSET(NVS_PARTITION)</td></tr>
<tr class="separator:a9d2e807fcd3e49aaf4c40d17a203dc01"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8b0c454d609035825f8309a7feb15500" id="r_a8b0c454d609035825f8309a7feb15500"><td class="memItemLeft" align="right" valign="top"><a id="a8b0c454d609035825f8309a7feb15500" name="a8b0c454d609035825f8309a7feb15500"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>LOG_MODULE_REGISTER</b> (SENSOR_NVS, LOG_LEVEL_INF)</td></tr>
<tr class="separator:a8b0c454d609035825f8309a7feb15500"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd3b35314828749fb2850c5b507be010" id="r_acd3b35314828749fb2850c5b507be010"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__nvs_8c.html#acd3b35314828749fb2850c5b507be010">sensor_nvs_setup</a> (uint8_t nvs_address_count)</td></tr>
<tr class="memdesc:acd3b35314828749fb2850c5b507be010"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup NVS for use. An enum list of addresses should be defined in application code, with the maximum number of addresses being defined. This must be called before any other NVS functions. This mounts the NVS partition and initializes it. The nvs_address_count will be used to know when the address is out of bounds.  <br /></td></tr>
<tr class="separator:acd3b35314828749fb2850c5b507be010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24adeba9780a84e3adba4e4cc4852a82" id="r_a24adeba9780a84e3adba4e4cc4852a82"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__nvs_8c.html#a24adeba9780a84e3adba4e4cc4852a82">sensor_nvs_write</a> (uint8_t address, const void *data, size_t length)</td></tr>
<tr class="memdesc:a24adeba9780a84e3adba4e4cc4852a82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write given data buffer to NVS with given address.  <br /></td></tr>
<tr class="separator:a24adeba9780a84e3adba4e4cc4852a82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac068b185263f41a08f176a986e2e8ffb" id="r_ac068b185263f41a08f176a986e2e8ffb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__nvs_8c.html#ac068b185263f41a08f176a986e2e8ffb">sensor_nvs_read</a> (uint8_t address, void *data, size_t length)</td></tr>
<tr class="memdesc:ac068b185263f41a08f176a986e2e8ffb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data from NVS with given address, data is written to the provided buffer.  <br /></td></tr>
<tr class="separator:ac068b185263f41a08f176a986e2e8ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af615860b9748846209f289beb45ce676" id="r_af615860b9748846209f289beb45ce676"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__nvs_8c.html#af615860b9748846209f289beb45ce676">sensor_nvs_delete</a> (uint8_t address)</td></tr>
<tr class="memdesc:af615860b9748846209f289beb45ce676"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete data from NVS with given address.  <br /></td></tr>
<tr class="separator:af615860b9748846209f289beb45ce676"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82eb1f53f08c01bc99029213a6203dc3" id="r_a82eb1f53f08c01bc99029213a6203dc3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sensor__nvs_8c.html#a82eb1f53f08c01bc99029213a6203dc3">sensor_nvs_clear</a> (void)</td></tr>
<tr class="memdesc:a82eb1f53f08c01bc99029213a6203dc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear all data from NVS. NVS must be setup again after clearing.  <br /></td></tr>
<tr class="separator:a82eb1f53f08c01bc99029213a6203dc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is a library to keep track of sensor information and configurations that are stored in the non-volatile storage (NVS) of the device. nrf52840_partition gives 32KB for storage_partition. </p>
<dl class="section author"><dt>Author</dt><dd>Tyler Garcia </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-05-08</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2025 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a82eb1f53f08c01bc99029213a6203dc3" name="a82eb1f53f08c01bc99029213a6203dc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82eb1f53f08c01bc99029213a6203dc3">&#9670;&#160;</a></span>sensor_nvs_clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sensor_nvs_clear </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear all data from NVS. NVS must be setup again after clearing. </p>
<dl class="section return"><dt>Returns</dt><dd>int 0 on success, -ERRNO errno code if error </dd></dl>

</div>
</div>
<a id="af615860b9748846209f289beb45ce676" name="af615860b9748846209f289beb45ce676"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af615860b9748846209f289beb45ce676">&#9670;&#160;</a></span>sensor_nvs_delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sensor_nvs_delete </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete data from NVS with given address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>address of NVS to delete </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0 on success, -1 on error </dd></dl>

</div>
</div>
<a id="ac068b185263f41a08f176a986e2e8ffb" name="ac068b185263f41a08f176a986e2e8ffb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac068b185263f41a08f176a986e2e8ffb">&#9670;&#160;</a></span>sensor_nvs_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sensor_nvs_read </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read data from NVS with given address, data is written to the provided buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>address of NVS to read from </td></tr>
    <tr><td class="paramname">data</td><td>pointer to data buffer to write </td></tr>
    <tr><td class="paramname">length</td><td>length of data to read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0 on success, -1 on error </dd></dl>

</div>
</div>
<a id="acd3b35314828749fb2850c5b507be010" name="acd3b35314828749fb2850c5b507be010"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd3b35314828749fb2850c5b507be010">&#9670;&#160;</a></span>sensor_nvs_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sensor_nvs_setup </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>nvs_address_count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup NVS for use. An enum list of addresses should be defined in application code, with the maximum number of addresses being defined. This must be called before any other NVS functions. This mounts the NVS partition and initializes it. The nvs_address_count will be used to know when the address is out of bounds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nvs_address_count</td><td>the number of addresses to use in the NVS partition </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0 on success, -1 on error </dd></dl>

</div>
</div>
<a id="a24adeba9780a84e3adba4e4cc4852a82" name="a24adeba9780a84e3adba4e4cc4852a82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24adeba9780a84e3adba4e4cc4852a82">&#9670;&#160;</a></span>sensor_nvs_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sensor_nvs_write </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write given data buffer to NVS with given address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>address of NVS to write to </td></tr>
    <tr><td class="paramname">data</td><td>pointer to data buffer to write </td></tr>
    <tr><td class="paramname">length</td><td>length of data to write </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int 0 on success, -1 on error </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
