\chapter{Lo\+Ra-\/\+BLE-\/\+Sensor}
\hypertarget{index}{}\label{index}\index{LoRa-\/BLE-\/Sensor@{LoRa-\/BLE-\/Sensor}}
\label{index_md_README}%
\Hypertarget{index_md_README}%
Hardware\+: Lo\+Ra-\/\+BLE-\/\+Sensor\hypertarget{index_autotoc_md1}{}\doxysection{\texorpdfstring{Overview}{Overview}}\label{index_autotoc_md1}
An n\+RF52 and SX1262 based Lo\+Ra\+WAN node that uses 2 configurable sensors, each with its own configurable power supply. The firmware for this node is built around the Zephyr RTOS. ZTEST and TWISTER are used for creating and running the unit tests for the device.\hypertarget{index_autotoc_md2}{}\doxysection{\texorpdfstring{Project Initialization}{Project Initialization}}\label{index_autotoc_md2}
After pulling down the repository, run the following command in the projects root directory\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{scripts/init\_project.sh}

\end{DoxyCode}


This will initialize the python environment(.venv), initialize west(.west), and update west, pulling down the appropriate zephyr dependencies needed for this project. These dependencies are determined by the west manifest(west.\+yml) in the {\ttfamily zephyr} folder. The update process may take time, when finished all of the dependencies should be located in the {\ttfamily deps} folder. After this the {\ttfamily app} folder can be built and twister can be used to run the {\ttfamily tests} folder.\hypertarget{index_autotoc_md3}{}\doxysection{\texorpdfstring{Code Breakdown}{Code Breakdown}}\label{index_autotoc_md3}
{\bfseries{\doxylink{main_8c}{main.\+c}}}
\begin{DoxyItemize}
\item Calls functions in {\bfseries{sensor\+\_\+app}} library
\begin{DoxyItemize}
\item Switches between states for the sensor
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{index_autotoc_md4}{}\doxysection{\texorpdfstring{Power Analysis}{Power Analysis}}\label{index_autotoc_md4}

\begin{DoxyItemize}
\item No power analysis is done yet
\end{DoxyItemize}\hypertarget{index_autotoc_md5}{}\doxysection{\texorpdfstring{Bugs/\+To-\/\+Do}{Bugs/To-Do}}\label{index_autotoc_md5}

\begin{DoxyItemize}
\item Add n\+PM1300 functionality
\begin{DoxyItemize}
\item Current, and Charge of the battery
\item Enable Charging
\end{DoxyItemize}
\item Add NFC for BLE Configurations
\item Error handling when state given is out of bounds
\end{DoxyItemize}\hypertarget{index_autotoc_md6}{}\doxysection{\texorpdfstring{Revision History}{Revision History}}\label{index_autotoc_md6}
Current Version\+: {\bfseries{V0.\+4.\+1}}

Version Breakdown\+: {\ttfamily \mbox{[}Major API Change\mbox{]}}.{\ttfamily \mbox{[}Minor Change/\+Added Functionality\mbox{]}}.{\ttfamily \mbox{[}Patch/bug fixes\mbox{]}}\hypertarget{index_autotoc_md7}{}\doxysubsubsection{\texorpdfstring{V0.\+4.\+1}{V0.4.1}}\label{index_autotoc_md7}

\begin{DoxyItemize}
\item Switched SDK to n\+RF Connect SDK V3.\+0.\+2
\begin{DoxyItemize}
\item Some functionality needed to change(e.\+g. resetting counter in {\bfseries{\doxylink{sensor__timer_8h}{sensor\+\_\+timer.\+h}}})
\end{DoxyItemize}
\item Cleaned code to remove compile warnings
\end{DoxyItemize}\hypertarget{index_autotoc_md8}{}\doxysubsubsection{\texorpdfstring{V0.\+4.\+0}{V0.4.0}}\label{index_autotoc_md8}

\begin{DoxyItemize}
\item PMIC LED is used for running an configuration state
\item PMIC battery voltage, temperature, current usb connections are added
\begin{DoxyItemize}
\item Battery voltage and battery temperature are sent over ble and lora
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{index_autotoc_md9}{}\doxysubsubsection{\texorpdfstring{V0.\+3.\+0}{V0.3.0}}\label{index_autotoc_md9}

\begin{DoxyItemize}
\item BLE DFU is implemented using SMP Server
\begin{DoxyItemize}
\item MCUMGR is what controls this
\end{DoxyItemize}
\item Logging for MCUBOOT is used with USB
\begin{DoxyItemize}
\item lora\+\_\+ble\+\_\+sensor flash partitions are edited to give mcuboot enough memory for usb logging
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{index_autotoc_md10}{}\doxysubsubsection{\texorpdfstring{V0.\+2.\+2}{V0.2.2}}\label{index_autotoc_md10}

\begin{DoxyItemize}
\item Names for sensor types and output voltages added to their own library
\begin{DoxyItemize}
\item Relates indexes to strings to make the ble interaction more human readable
\end{DoxyItemize}
\item MCUBOOT is added to project
\begin{DoxyItemize}
\item For later use with OTA updates
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{index_autotoc_md11}{}\doxysubsubsection{\texorpdfstring{V0.\+2.\+1}{V0.2.1}}\label{index_autotoc_md11}

\begin{DoxyItemize}
\item Changes made for low power consumption
\begin{DoxyItemize}
\item Digital inputs changed to active low in dts
\item CONFIF\+\_\+\+PM\+\_\+\+DEVICE enabled
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{index_autotoc_md12}{}\doxysubsubsection{\texorpdfstring{V0.\+2.\+0}{V0.2.0}}\label{index_autotoc_md12}

\begin{DoxyItemize}
\item version.\+conf file is created from git tags when device is built
\begin{DoxyItemize}
\item the code for this is in CMake\+Lists.\+txt
\end{DoxyItemize}
\item Firmware and hardware versions added to Lo\+Ra\+WAN packet
\item Sensor Configurations added to Lo\+Ra\+WAN packet
\end{DoxyItemize}\hypertarget{index_autotoc_md13}{}\doxysubsubsection{\texorpdfstring{V0.\+1.\+0}{V0.1.0}}\label{index_autotoc_md13}

\begin{DoxyItemize}
\item Initial working version of the code
\begin{DoxyItemize}
\item All lorawan setup and send functionality is in place
\item Both sensors can be fully configured to VOLTAGE\+\_\+\+SENSOR, CURRENT\+\_\+\+SENSOR, or PULSE\+\_\+\+SENSOR
\item Both sensors can be switched from no power, 3.\+3V, 5V, 6V, 12V or 24V
\item BLE functionality works for configuring the Lo\+Ra\+WAN and Sensors
\item Scheduling and timing system is fully working 
\end{DoxyItemize}
\end{DoxyItemize}